(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({"./public/src/main.js":[function(require,module,exports){
window.game = new Phaser.Game(800, 480, Phaser.CANVAS, '');
window.socket; //Refactor socket stuff into its own class?
window.player;
window.remotePlayers = [];

startGame();

function startGame() {
	game.state.add('Boot', require('./game/states/Boot'));
	game.state.add('Preloader', require('./game/states/Preloader'));
	game.state.add('Level', require('./game/states/Level'));

	game.state.start('Boot');
};
},{"./game/states/Boot":"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Boot.js","./game/states/Level":"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Level.js","./game/states/Preloader":"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Preloader.js"}],"C:\\Projects\\bomb-arena\\public\\src\\game\\Player.js":[function(require,module,exports){
var Player = function(x, y) {
	Phaser.Sprite.call(this, game, x, y, 'bomberman');

  this.facing = 'down';

	game.physics.enable(this, Phaser.Physics.ARCADE);
	this.animations.add('down', [0, 1, 2, 3, 4], 10, true);
  	this.animations.add('up', [5, 6, 7, 8, 9], 10, true);
  	this.animations.add('right', [10, 11, 12], 10, true);
  	this.animations.add('left', [13, 14, 15], 10, true);

	game.add.existing(this);
};

Player.prototype = Object.create(Phaser.Sprite.prototype);

Player.prototype.move = function() {
	  var moving = true;;

  	if (game.input.keyboard.isDown(Phaser.Keyboard.LEFT)) {
  		player.body.velocity.y = 0;
  		player.body.velocity.x = -200;
  		this.facing = 'left';
  		// player.animations.play('left');
  	} else if (game.input.keyboard.isDown(Phaser.Keyboard.RIGHT)) {
  		player.body.velocity.y = 0;
  		player.body.velocity.x = 200;
  		this.facing = 'right';
  		// player.animations.play('right');
  	} else if (game.input.keyboard.isDown(Phaser.Keyboard.UP)) {
  		player.body.velocity.x = 0;
  		player.body.velocity.y = -200;
  		this.facing = 'up';
  		// player.animations.play('up');
  	} else if (game.input.keyboard.isDown(Phaser.Keyboard.DOWN)) {
  		player.body.velocity.x = 0;
  		player.body.velocity.y = 200;
  		this.facing = 'down';
  		// player.animations.play('down');
  	} else {
      moving = false;
  		player.body.velocity.x = 0;
  		player.body.velocity.y = 0;
  		player.animations.stop();
  	}

  	if(moving)  {
      player.animations.play(this.facing);
      socket.emit("move player", {x: player.body.position.x, y: player.body.position.y, facing: this.facing});
    }
  };

module.exports = Player;
},{}],"C:\\Projects\\bomb-arena\\public\\src\\game\\RemotePlayer.js":[function(require,module,exports){
var RemotePlayer = function(x, y, id) {
	this.id = id;

	Phaser.Sprite.call(this, game, x, y, "bomberman");

	game.physics.enable(this, Phaser.Physics.ARCADE);

	this.animations.add('down', [0, 1, 2, 3, 4], 10, true);
  	this.animations.add('up', [5, 6, 7, 8, 9], 10, true);
  	this.animations.add('right', [10, 11, 12], 10, true);
  	this.animations.add('left', [13, 14, 15], 10, true);

	game.add.existing(this);
};

RemotePlayer.prototype = Object.create(Phaser.Sprite.prototype);

module.exports = RemotePlayer;
},{}],"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Boot.js":[function(require,module,exports){
var Boot = function () {};

module.exports = Boot;

Boot.prototype = {

  preload: function () {
    // Fill in later.
  },

  create: function () {
    game.stage.disableVisibilityChange = true; // So that game doesn't stop when window loses focus.
    game.input.maxPointers = 1;

    if (game.device.desktop) {
      game.stage.scale.pageAlignHorizontally = true;
    } else {
      game.stage.scaleMode = Phaser.StageScaleMode.SHOW_ALL;
      game.stage.scale.minWidth =  480;
      game.stage.scale.minHeight = 260;
      game.stage.scale.maxWidth = 640;
      game.stage.scale.maxHeight = 480;
      game.stage.scale.forceLandscape = true;
      game.stage.scale.pageAlignHorizontally = true;
      game.stage.scale.setScreenSize(true);
    }

    game.state.start('Preloader');
  }
};

},{}],"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Level.js":[function(require,module,exports){
var Player = require('../Player');
var RemotePlayer = require('../RemotePlayer');

var Level = function () {};

module.exports = Level;

Level.prototype = {

  preload: function () {
    this.load.spritesheet("bomberman", "assets/sprites/bomberman.png", 28, 50);
  },

  create: function () {
  	socket = io("http://localhost:8120"); // By default, this connects to the local host.
    
    player = new Player(Math.round(Math.random() * game.camera.width), Math.round(Math.random() * game.camera.height));

    setEventHandlers();
  },

  update: function() {
  	player.move();
  }
};

  // TODO: Move this somewhere else.
function setEventHandlers() {
	socket.on("connect", onSocketConnected);
  	socket.on("disconnect", onSocketDisconnect);
  	socket.on("new player", onNewPlayer);
  	socket.on("move player", onMovePlayer);
  	socket.on("remove player", onRemovePlayer);
};

function onSocketConnected() {
	console.log("Connected to socket server.");

	socket.emit("new player", {x: player.position.x, y: player.position.y});
};

function onSocketDisconnect() {
	console.log("Disconnected from socket server.");

	this.broadcast.emit("remove player", {id: this.id});
};

function onNewPlayer(data) {
	console.log("New player connected: ");
	console.log(data);

	remotePlayers.push(new RemotePlayer(data.x, data.y, data.id));
};

function onMovePlayer(data) {

};

function onRemovePlayer(data) {
	var playerToRemove = findRemotePlayerById(data.id);

	playerToRemove.destroy();

	remotePlayers.splice(remotePlayers.indexOf(playerToRemove), 1);
};

function findRemotePlayerById(id) {
	for(var i = 0; i < remotePlayers.length; i++) {
		if(remotePlayers[i].id == id)
			return remotePlayers[i];
	}

	return false;
};
},{"../Player":"C:\\Projects\\bomb-arena\\public\\src\\game\\Player.js","../RemotePlayer":"C:\\Projects\\bomb-arena\\public\\src\\game\\RemotePlayer.js"}],"C:\\Projects\\bomb-arena\\public\\src\\game\\states\\Preloader.js":[function(require,module,exports){
var Preloader = function () {};

module.exports = Preloader;

Preloader.prototype = {

  preload: function () {
    // Fill in later.
  },

  create: function () {
    game.state.start('Level');
  }
};

},{}]},{},["./public/src/main.js"]);
